C251 COMPILER V5.60.0,  main                                                               25/01/26  03:00:11  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: S:\Embedded\Keil\C251\BIN\C251.EXE Sources\main.c XSMALL BROWSE INCDIR(.\Sources\inc;.\Sources\app;
                    -.\Sources\hal;.\Sources\fml;.\Sources\utils) DEBUG PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj) 

stmt  level    source

    1          //<<AICUBE_USER_HEADER_REMARK_BEGIN>>
    2          ////////////////////////////////////////
    3          // 在此添加用户文件头说明信息  
    4          // 文件名称: main.c
    5          // 文件描述: 
    6          // 文件版本: V1.0
    7          // 修改记录:
    8          //   1. (2025-12-13) 创建文件
    9          ////////////////////////////////////////
   10          //<<AICUBE_USER_HEADER_REMARK_END>>
   11          
   12          
   13          #include "config.h"                     //默认已包含stdio.h、intrins.h等头文件
   14          
   15          
   16          //<<AICUBE_USER_INCLUDE_BEGIN>>
   17          #include "fml/ws2812_driver.h"
   18          #include "app/ws2812_display.h"
   19          //<<AICUBE_USER_INCLUDE_END>>
   20          
   21          
   22          //<<AICUBE_USER_GLOBAL_DEFINE_BEGIN>>
   23          // WS2812 相关全局变量已移至 app/ws2812_display.c（static）
   24          // 由定时器中断和应用接口进行控制
   25          
   26          //<<AICUBE_USER_GLOBAL_DEFINE_END>>
   27          
   28          
   29          
   30          ////////////////////////////////////////
   31          // 项目主函数
   32          // 入口参数: 无
   33          // 函数返回: 无
   34          ////////////////////////////////////////
   35          void main(void)
   36          {
   37   1          //<<AICUBE_USER_MAIN_INITIAL_BEGIN>>
   38   1          // 在此添加用户主函数初始化代码  
   39   1          //<<AICUBE_USER_MAIN_INITIAL_END>>
   40   1      
   41   1          SYS_Init();
   42   1      
   43   1          //<<AICUBE_USER_MAIN_CODE_BEGIN>>
   44   1           
   45   1          //<<AICUBE_USER_MAIN_CODE_END>>
   46   1      
   47   1          while (1)
   48   1          {
   49   2              //<<AICUBE_USER_MAIN_LOOP_BEGIN>>
   50   2              ws2812_display_update();
   51   2              delay_ms(100);
   52   2      //              ws2812_send_grb(255, 0, 0); 
   53   2      //              delay_ms(1000);
   54   2      //              ws2812_send_grb(0, 255, 0); 
   55   2      //              delay_ms(1000);
   56   2      //              ws2812_send_grb(0, 0, 255); 
   57   2      //              delay_ms(1000);
   58   2              //<<AICUBE_USER_MAIN_LOOP_END>>
C251 COMPILER V5.60.0,  main                                                               25/01/26  03:00:11  PAGE 2   

   59   2          }
   60   1      }
   61          
   62          ////////////////////////////////////////
   63          // 系统初始化函数
   64          // 入口参数: 无
   65          // 函数返回: 无
   66          ////////////////////////////////////////
   67          void SYS_Init(void)
   68          {
   69   1          EnableAccessXFR();                  //使能访问扩展XFR
   70   1          AccessCodeFastest();                //设置最快速度访问程序代码
   71   1          AccessIXramFastest();               //设置最快速度访问内部XDATA
   72   1          IAP_SetTimeBase();                  //设置IAP等待参数,产生1us时基
   73   1      
   74   1          //<<AICUBE_USER_PREINITIAL_CODE_BEGIN>>
   75   1          // 在此添加用户预初始化代码  
   76   1          //<<AICUBE_USER_PREINITIAL_CODE_END>>
   77   1      
   78   1          P0M0 = 0x00; P0M1 = 0x00;           //初始化P0口为准双向口模式
   79   1          P1M0 = 0x00; P1M1 = 0x00;           //初始化P1口为准双向口模式
   80   1          P2M0 = 0x00; P2M1 = 0x00;           //初始化P2口为准双向口模式
   81   1          P3M0 = 0x00; P3M1 = 0x00;           //初始化P3口为准双向口模式
   82   1          P4M0 = 0x00; P4M1 = 0x00;           //初始化P4口为准双向口模式
   83   1          P5M0 = 0x00; P5M1 = 0x00;           //初始化P5口为准双向口模式
   84   1          P6M0 = 0x00; P6M1 = 0x00;           //初始化P6口为准双向口模式
   85   1          P7M0 = 0x00; P7M1 = 0x00;           //初始化P7口为准双向口模式
   86   1      
   87   1          TIMER0_Init();                      //定时器0初始化
   88   1          EXTI0_Init();                       //INT0初始化
   89   1          EXTI1_Init();                       //INT1初始化
   90   1      //    PWMA_Init();                        //高级PWMA初始化
   91   1          delay_ms(1);
   92   1          USBLIB_Init();                      //USB库初始化
   93   1          delay_ms(1);
   94   1      
   95   1          //<<AICUBE_USER_INITIAL_CODE_BEGIN>>
   96   1          // 在此添加用户初始化代码  
   97   1          //<<AICUBE_USER_INITIAL_CODE_END>>
   98   1      
   99   1          EnableGlobalInt();                  //使能全局中断
  100   1      }
  101          
  102          ////////////////////////////////////////
  103          // 微秒延时函数
  104          // 入口参数: us (设置延时的微秒值)
  105          // 函数返回: 无
  106          ////////////////////////////////////////
  107          void delay_us(uint16_t us)
  108          {
  109   1          do
  110   1          {
  111   2              NOP(34);                        //(MAIN_Fosc + 500000) / 1000000 - 6
  112   2          } while (--us);
  113   1      }
  114          
  115          
  116          ////////////////////////////////////////
  117          // 毫秒延时函数
  118          // 入口参数: ms (设置延时的毫秒值)
  119          // 函数返回: 无
  120          ////////////////////////////////////////
  121          void delay_ms(uint16_t ms)
  122          {
  123   1          uint16_t i;
  124   1      
C251 COMPILER V5.60.0,  main                                                               25/01/26  03:00:11  PAGE 3   

  125   1          do
  126   1          {
  127   2              i = MAIN_Fosc / 6000;
  128   2              while (--i);
  129   2          } while (--ms);
  130   1      }
  131          
  132          
  133          //<<AICUBE_USER_FUNCTION_IMPLEMENT_BEGIN>>
  134          // 所有应用逻辑已整理到对应模块：
  135          // - timer.c: TIMER0_Init() 和 中断处理 TIMER0_ISR()
  136          // - app/ws2812_display.c: 显示颜色状态和更新函数
  137          //<<AICUBE_USER_FUNCTION_IMPLEMENT_END>>
  138          
  139          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       188     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         2     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

C251 COMPILER V5.60.0,  pwm                                                                25/01/26  03:00:11  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE pwm
OBJECT MODULE PLACED IN .\Objects\pwm.obj
COMPILER INVOKED BY: S:\Embedded\Keil\C251\BIN\C251.EXE Sources\pwm.c XSMALL BROWSE INCDIR(.\Sources\inc;.\Sources\app;.
                    -\Sources\hal;.\Sources\fml;.\Sources\utils) DEBUG PRINT(.\Listings\pwm.lst) OBJECT(.\Objects\pwm.obj) 

stmt  level    source

    1          //<<AICUBE_USER_HEADER_REMARK_BEGIN>>
    2          ////////////////////////////////////////
    3          // 在此添加用户文件头说明信息  
    4          // 文件名称: pwm.c
    5          // 文件描述: 
    6          // 文件版本: V1.0
    7          // 修改记录:
    8          //   1. (2026-01-25) 创建文件
    9          ////////////////////////////////////////
   10          //<<AICUBE_USER_HEADER_REMARK_END>>
   11          
   12          
   13          #include "config.h"
   14          
   15          
   16          //<<AICUBE_USER_INCLUDE_BEGIN>>
   17          // 在此添加用户头文件包含  
   18          //<<AICUBE_USER_INCLUDE_END>>
   19          
   20          
   21          //<<AICUBE_USER_GLOBAL_DEFINE_BEGIN>>
   22          // 在此添加用户全局变量定义、用户宏定义以及函数声明  
   23          //<<AICUBE_USER_GLOBAL_DEFINE_END>>
   24          
   25          
   26          uint8_t xdata pu8PWMADMATxBuffer[100];  //串口ADMA发送缓冲区数组
   27          
   28          ////////////////////////////////////////
   29          // PWMA初始化函数
   30          // 入口参数: 无
   31          // 函数返回: 无
   32          ////////////////////////////////////////
   33          void PWMA_Init(void)
   34          {
   35   1          PWMA_C1SwitchP1011();               //设置PWMA通道1数据端口: PWM1P (P1.0), PWM1N (P1.1)
   36   1      
   37   1          HSPWMA_Disable();                   //关闭高速模式，使用同步方式进行初始化
   38   1          PWMA_InternalClockMode();           //选择内部时钟模式
   39   1          PWMA_SetClockDivider(0);            //设置16位预分频
   40   1          PWMA_SetReload16(999);              //设置16位重载值
   41   1          PWMA_BufferARR();                   //使能重载值寄存器预装载功能
   42   1          PWMA_SetCounter(0);                 //初始化计数值
   43   1      
   44   1          PWMA_CC1PDisable();                 //关闭通道
   45   1          PWMA_CC1Output();                   //使能通道输出功能
   46   1          PWMA_CC1PEnable();                  //打开通道
   47   1          PWM_UpdateDuty(PWMA_CH1, 333);      //设置通道的PWM占空比
   48   1          PWMA_OC1REFPWMMode1();              //设置通道输出参考信号为PWM模式1信号
   49   1          PWMA_BufferCCR1();                  //使能CCRn预装载功能
   50   1          PWMA_CC1PNonInverted();             //设置正极通道输出高电平有效
   51   1          PWMA_EnablePWM1POutput();           //使能正极通道输出
   52   1          PWMA_DisablePWM1NOutput();          //关闭负极通道输出
   53   1      
   54   1          PWMA_EnableMainOutput();            //使能PWM主输出
   55   1      
   56   1          PWMA_UpdateIntAsDMAEvent();         //设置PWMA更新中断作为DMA事件
   57   1          PWMA_SetDMABaseAddress(13);         //设置PWMA DMA的寄存器基地址
   58   1          PWMA_SetDMABurstCount(0);           //设置PWMA DMA突发传输次数
C251 COMPILER V5.60.0,  pwm                                                                25/01/26  03:00:11  PAGE 2   

   59   1          PWMA_SetDMABurst1Byte();            //设置PWMA DMA突发传输字节数
   60   1          PWMA_DMASkipSpace();                //设置PWMA DMA时跳过保留寄存器（空白字节）
   61   1          PWMA_SetDMAOutput();                //设置PWMA DMA方向为输出（DMA输出PWM波形）
   62   1      
   63   1          DMA_PWMA_SetTxAmount(99);           //设置PWMA发送DMA总字节数
   64   1          DMA_PWMA_SetTxAddress(pu8PWMADMATxBuffer); //设置PWMA发送DMA缓冲区地址
   65   1          DMA_PWMA_SetInterval(0);            //设置PWMA发送DMA字节间隔时间（系统时钟）
   66   1          DMA_PWMA_ClearTxFlag();             //清除PWMA发送DMA中断标志
   67   1          DMA_PWMA_SetTxBusPriority(0);       //设置总线访问为最低优先级
   68   1          DMA_PWMA_EnableTx();                //使能PWMA发送DMA功能
   69   1          PWMA_EnableDMA();                   //设置PWMA DMA方向为输出（DMA输出PWM波形）
   70   1      
   71   1          PWMA_Run();                         //PWMA开始运行
   72   1      //  DMA_PWMA_TriggerTx();               //触发PWMA发送DMA
   73   1      
   74   1          //<<AICUBE_USER_PWM0_INITIAL_BEGIN>>
   75   1          // 在此添加用户初始化代码  
   76   1          //<<AICUBE_USER_PWM0_INITIAL_END>>
   77   1      }
   78          
   79          ////////////////////////////////////////
   80          // 设置PWM通道输出占空比
   81          // 入口参数: PWMx: (目标PWM组和通道索引)
   82          //           nCompare: (PWM占空比值)
   83          //           iMode: (PWM输出模式：PWM_MODE1/PWM_MODE2)
   84          // 函数返回: 无
   85          ////////////////////////////////////////
   86          void PWM_UpdateDuty(uint8_t PWMx, uint16_t nCompare)
   87          {
   88   1          switch (PWMx)
   89   1          {
   90   2          case PWMA_CH1:
   91   2              PWMA_SetCCR1Value(nCompare);    //设置通道比较值
   92   2              break;
   93   2          case PWMA_CH2:
   94   2              PWMA_SetCCR2Value(nCompare);    //设置通道比较值
   95   2              break;
   96   2          case PWMA_CH3:
   97   2              PWMA_SetCCR3Value(nCompare);    //设置通道比较值
   98   2              break;
   99   2          case PWMA_CH4:
  100   2              PWMA_SetCCR4Value(nCompare);    //设置通道比较值
  101   2              break;
  102   2          case PWMB_CH5:
  103   2              PWMB_SetCCR5Value(nCompare);    //设置通道比较值
  104   2              break;
  105   2          case PWMB_CH6:
  106   2              PWMB_SetCCR6Value(nCompare);    //设置通道比较值
  107   2              break;
  108   2          case PWMB_CH7:
  109   2              PWMB_SetCCR7Value(nCompare);    //设置通道比较值
  110   2              break;
  111   2          case PWMB_CH8:
  112   2              PWMB_SetCCR8Value(nCompare);    //设置通道比较值
  113   2              break;
  114   2          }
  115   1      }
  116          
  117          ////////////////////////////////////////
  118          // 读取PWM通道捕获值
  119          // 入口参数: PWMx: (目标PWM组和通道索引)
  120          // 函数返回: 捕获值
  121          ////////////////////////////////////////
  122          uint16_t PWM_ReadCapture(uint8_t PWMx)
  123          {
  124   1          uint16_t cap;
C251 COMPILER V5.60.0,  pwm                                                                25/01/26  03:00:11  PAGE 3   

  125   1      
  126   1          switch (PWMx)
  127   1          {
  128   2          case PWMA_CH1:  cap = PWMA_ReadCCR1Value(); break;
  129   2          case PWMA_CH2:  cap = PWMA_ReadCCR2Value(); break;
  130   2          case PWMA_CH3:  cap = PWMA_ReadCCR3Value(); break;
  131   2          case PWMA_CH4:  cap = PWMA_ReadCCR4Value(); break;
  132   2          case PWMB_CH5:  cap = PWMB_ReadCCR5Value(); break;
  133   2          case PWMB_CH6:  cap = PWMB_ReadCCR6Value(); break;
  134   2          case PWMB_CH7:  cap = PWMB_ReadCCR7Value(); break;
  135   2          case PWMB_CH8:  cap = PWMB_ReadCCR8Value(); break;
  136   2          default: cap = 0;
  137   2          }
  138   1      
  139   1          return cap;
  140   1      }
  141          
  142          ////////////////////////////////////////
  143          // 设置高速模式PWM通道输出占空比
  144          // 入口参数: PWMx: (目标PWM组和通道索引)
  145          //           nCompare: (PWM占空比值)
  146          // 函数返回: 无
  147          ////////////////////////////////////////
  148          void HSPWM_UpdateDuty(uint8_t PWMx, uint16_t nCompare)
  149          {
  150   1          switch (PWMx)
  151   1          {
  152   2          case PWMA_CH1:
  153   2              HSPWMA_SetCCR1Value(nCompare);  //设置通道比较值
  154   2              break;
  155   2          case PWMA_CH2:
  156   2              HSPWMA_SetCCR2Value(nCompare);  //设置通道比较值
  157   2              break;
  158   2          case PWMA_CH3:
  159   2              HSPWMA_SetCCR3Value(nCompare);  //设置通道比较值
  160   2              break;
  161   2          case PWMA_CH4:
  162   2              HSPWMA_SetCCR4Value(nCompare);  //设置通道比较值
  163   2              break;
  164   2          case PWMB_CH5:
  165   2              HSPWMB_SetCCR5Value(nCompare);  //设置通道比较值
  166   2              break;
  167   2          case PWMB_CH6:
  168   2              HSPWMB_SetCCR6Value(nCompare);  //设置通道比较值
  169   2              break;
  170   2          case PWMB_CH7:
  171   2              HSPWMB_SetCCR7Value(nCompare);  //设置通道比较值
  172   2              break;
  173   2          case PWMB_CH8:
  174   2              HSPWMB_SetCCR8Value(nCompare);  //设置通道比较值
  175   2              break;
  176   2          }
  177   1      }
  178          
  179          ////////////////////////////////////////
  180          // 读取高速模式PWM通道捕获值
  181          // 入口参数: PWMx: (目标PWM组和通道索引)
  182          // 函数返回: 捕获值
  183          ////////////////////////////////////////
  184          uint16_t HSPWM_ReadCapture(uint8_t PWMx)
  185          {
  186   1          uint16_t cap;
  187   1      
  188   1          switch (PWMx)
  189   1          {
  190   2          case PWMA_CH1:  cap = HSPWMA_ReadCCR1Value();   break;
C251 COMPILER V5.60.0,  pwm                                                                25/01/26  03:00:11  PAGE 4   

  191   2          case PWMA_CH2:  cap = HSPWMA_ReadCCR2Value();   break;
  192   2          case PWMA_CH3:  cap = HSPWMA_ReadCCR3Value();   break;
  193   2          case PWMA_CH4:  cap = HSPWMA_ReadCCR4Value();   break;
  194   2          case PWMB_CH5:  cap = HSPWMB_ReadCCR5Value();   break;
  195   2          case PWMB_CH6:  cap = HSPWMB_ReadCCR6Value();   break;
  196   2          case PWMB_CH7:  cap = HSPWMB_ReadCCR7Value();   break;
  197   2          case PWMB_CH8:  cap = HSPWMB_ReadCCR8Value();   break;
  198   2          default: cap = 0;
  199   2          }
  200   1      
  201   1          return cap;
  202   1      }
  203          
  204          ////////////////////////////////////////
  205          // 异步方式读取PWMA特殊功能寄存器
  206          // 入口参数: addr: (PWMA特殊功能寄存器的低7位)
  207          // 函数返回: 寄存器的值
  208          ////////////////////////////////////////;
  209          uint8_t HSPWMA_ReadReg(uint8_t addr)
  210          {
  211   1          uint8_t dat;
  212   1      
  213   1          while (HSPWMA_CheckBusy());         //等待前一个异步读写完成
  214   1          HSPWMA_AsyncRead(addr, dat);        //触发异步方式读取寄存器
  215   1      
  216   1          return dat;
  217   1      }
  218          
  219          ////////////////////////////////////////
  220          // 异步方式写PWMA特殊功能寄存器
  221          // 入口参数: addr: (PWMA特殊功能寄存器的低7位)
  222          //           dat: (待写入的数据)
  223          // 函数返回: 无
  224          ////////////////////////////////////////;
  225          void HSPWMA_WriteReg(uint8_t addr, uint8_t dat)
  226          {
  227   1          while (HSPWMA_CheckBusy());         //等待前一个异步读写完成
  228   1          HSPWMA_AsyncWrite(addr, dat);       //触发异步方式写寄存器
  229   1      }
  230          
  231          ////////////////////////////////////////
  232          // 异步方式读取PWMB特殊功能寄存器
  233          // 入口参数: addr: (PWMB特殊功能寄存器的低7位)
  234          // 函数返回: 寄存器的值
  235          ////////////////////////////////////////;
  236          uint8_t HSPWMB_ReadReg(uint8_t addr)
  237          {
  238   1          uint8_t dat;
  239   1      
  240   1          while (HSPWMB_CheckBusy());         //等待前一个异步读写完成
  241   1          HSPWMB_AsyncRead(addr, dat);        //触发异步方式读取寄存器
  242   1      
  243   1          return dat;
  244   1      }
  245          
  246          ////////////////////////////////////////
  247          // 异步方式写PWMB特殊功能寄存器
  248          // 入口参数: addr: (PWMB特殊功能寄存器的低7位)
  249          //           dat: (待写入的数据)
  250          // 函数返回: 无
  251          ////////////////////////////////////////;
  252          void HSPWMB_WriteReg(uint8_t addr, uint8_t dat)
  253          {
  254   1          while (HSPWMB_CheckBusy());         //等待前一个异步读写完成
  255   1          HSPWMB_AsyncWrite(addr, dat);       //触发异步方式写寄存器
  256   1      }
C251 COMPILER V5.60.0,  pwm                                                                25/01/26  03:00:11  PAGE 5   

  257          
  258          
  259          
  260          //<<AICUBE_USER_FUNCTION_IMPLEMENT_BEGIN>>
  261          // 在此添加用户函数实现代码  
  262          //<<AICUBE_USER_FUNCTION_IMPLEMENT_END>>
  263          
  264          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      1507     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =       100     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
